---
/**
 * Tag Detail Page - Shows posts and apps filtered by tag
 */

import PageHeader from "../../components/PageHeader.astro";
import EntryCard from "../../components/EntryCard.astro";
import Link from "../../components/Link.astro";
import Layout from "../../layouts/Layout.astro";
import { getTagMap } from "../../utils/content";
import type { FeedItem } from "../../utils/content";
import "../../styles/home.css";

export async function getStaticPaths() {
  const tagMap = await getTagMap();

  return [...tagMap.entries()].map(([tag, items]) => ({
    params: { tag },
    props: { tag, items },
  }));
}

const { tag, items } = Astro.props;
---

<Layout title={`#${tag}`} description={`Posts and apps tagged "${tag}"`}>
  <PageHeader />

  <main id="main-content" class="home-main">
    <Link href="/tags/" class="tag-back-link" variant="muted">&larr; all tags</Link>
    <h1 class="tag-page-title">#{tag}</h1>
    <p class="tag-page-count">{items.length} {items.length === 1 ? "entry" : "entries"}</p>
    <section class="archive">
      <ul class="post-list">
        {items.map((item: FeedItem) => (
          <EntryCard entry={item.entry} />
        ))}
      </ul>
    </section>
  </main>
</Layout>

<style>
  .tag-back-link {
    display: inline-block;
    font-family: var(--font-mono-brand);
    font-size: var(--font-size-xxs);
    letter-spacing: var(--letter-spacing-loose);
    color: var(--color-text-muted);
    text-decoration: none;
    margin-bottom: var(--space-4);
    transition: color var(--duration-normal) var(--ease-out);
  }

  .tag-back-link:hover {
    color: var(--color-primary);
  }

  .tag-page-title {
    font-family: var(--font-mono-brand);
    font-size: var(--font-size-h2);
    font-weight: 400;
    margin-top: 0;
    margin-bottom: var(--space-2);
    color: var(--color-primary);
  }

  .tag-page-count {
    font-family: var(--font-mono-brand);
    font-size: var(--font-size-xxs);
    letter-spacing: var(--letter-spacing-slight);
    color: var(--color-text-muted);
    margin: 0 0 var(--space-10) 0;
  }

  @media (max-width: 600px) {
    /* @breakpoint-mobile */
    .tag-page-title {
      font-size: var(--font-size-h3);
      margin-bottom: var(--space-6);
    }
  }
</style>
