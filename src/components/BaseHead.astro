---
/**
 * BaseHead - Common metadata and critical head scripts
 */
import { ClientRouter } from "astro:transitions";
import FontPreload from "./FontPreload.astro";

interface Props {
  title: string;
  description: string;
  image?: string;
}

const { title, description, image } = Astro.props;
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const siteURL = Astro.site?.toString().replace(/\/$/, "") ?? "https://fpl0.github.io";

const ogImage = image
  ? image.startsWith("http")
    ? image
    : `${siteURL}${image.startsWith("/") ? "" : "/"}${image}`
  : `${siteURL}/favicon.svg`;

const twitterCardType = image ? "summary_large_image" : "summary";
---

<!-- Theme init - runs before paint to prevent flash -->
<script is:inline>
  (function () {
    function getTheme() {
      var stored = localStorage.getItem("theme");
      if (stored) return stored;
      return window.matchMedia("(prefers-color-scheme: dark)").matches
        ? "dark"
        : "light";
    }
    document.documentElement.setAttribute("data-theme", getTheme());
    document.addEventListener("astro:before-swap", function (e) {
      e.newDocument.documentElement.setAttribute("data-theme", getTheme());
    });
  })();
</script>

<FontPreload />
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<!-- CSP -->
<meta
  http-equiv="Content-Security-Policy"
  content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.googletagmanager.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob: https://images.unsplash.com https://i.ytimg.com https://pbs.twimg.com https://abs.twimg.com; font-src 'self'; connect-src 'self' https://www.google-analytics.com https://www.googletagmanager.com; frame-src https://www.youtube.com https://www.youtube-nocookie.com; object-src 'none'; base-uri 'self'; form-action 'self'"
/>
<meta name="generator" content={Astro.generator} />

<!-- SEO -->
<title>{title} | fpl0</title>
<meta name="description" content={description} />
<link rel="canonical" href={canonicalURL} />
<meta name="author" content="Filipe Lima" />

<!-- Open Graph -->
<meta property="og:type" content="website" />
<meta property="og:url" content={canonicalURL} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:site_name" content="fpl0" />
<meta property="og:image" content={ogImage} />

<!-- Twitter -->
<meta name="twitter:card" content={twitterCardType} />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={ogImage} />

<!-- Icons -->
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="icon" href="/favicon.ico" />

<!-- Resource hints -->
<link rel="dns-prefetch" href="https://www.googletagmanager.com" />

<!-- RSS Feed -->
<link
  rel="alternate"
  type="application/rss+xml"
  title="fpl0 RSS Feed"
  href="/rss.xml"
/>

<!-- View Transitions -->
<ClientRouter />
