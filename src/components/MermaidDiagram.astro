---
/**
 * MermaidDiagram - Source toggle for pre-rendered Mermaid diagrams
 *
 * Diagrams are rendered to dual-theme SVGs at build time by
 * rehype-mermaid-dual.mjs. This component only wires up the
 * "source" toggle button interaction.
 */
---

<script>
  import { onPageReady } from "../utils/lifecycle";

  onPageReady((signal) => {
    document
      .querySelectorAll<HTMLButtonElement>(".mermaid-toggle")
      .forEach((btn) => {
        btn.addEventListener("click", () => {
          const container = btn.closest(".mermaid-container");
          if (!container) return;

          const source =
            container.querySelector<HTMLPreElement>(".mermaid-source");
          const lightSvg =
            container.querySelector<HTMLDivElement>(".mermaid-light");
          const darkSvg =
            container.querySelector<HTMLDivElement>(".mermaid-dark");
          if (!source) return;

          const showing = !source.hidden;
          source.hidden = showing;
          if (lightSvg) lightSvg.style.display = showing ? "" : "none";
          if (darkSvg) darkSvg.style.display = showing ? "" : "none";
          btn.classList.toggle("is-active", !showing);
          btn.setAttribute(
            "aria-label",
            showing ? "View diagram source" : "View rendered diagram",
          );
        }, { signal });
      });
  });
</script>
