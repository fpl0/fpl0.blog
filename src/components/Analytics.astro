---
/**
 * Analytics - Deferred Google Analytics loading
 * Loads GA script only after user interaction or 3s timeout
 * to avoid blocking initial page render.
 */
---

<script is:inline>
  (function () {
    var loaded = false;
    var GA_ID = "G-1QYZZMNKT7";

    function loadGA() {
      if (loaded) return;
      loaded = true;

      var s = document.createElement("script");
      s.src = "https://www.googletagmanager.com/gtag/js?id=" + GA_ID;
      s.async = true;
      document.head.appendChild(s);

      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      window.gtag = gtag;
      gtag("js", new Date());
      gtag("config", GA_ID);
    }

    // Load on interaction or after 3s
    ["scroll", "click", "touchstart", "keydown"].forEach(function (e) {
      document.addEventListener(e, loadGA, { once: true, passive: true });
    });
    setTimeout(loadGA, 3000);

    // Handle Astro page transitions
    document.addEventListener("astro:page-load", loadGA);
  })();
</script>
